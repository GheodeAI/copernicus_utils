<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERA5 Configuration Generator - Copernicus CDS</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸŒ ERA5 Configuration Generator</h1>
            <p class="subtitle">Graphical interface to generate CONFIG.conf file - Copernicus Climate Data Store</p>
            <a href="https://github.com/GheodeAI/copernicus_utils" target="_blank" rel="noopener noreferrer" class="github-link" title="View on GitHub">
                <svg height="24" width="24" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                View Repository
            </a>
        </header>

        <div class="content">
            <!-- API Configuration Section -->
            <section class="config-section">
                <h2>ğŸ”— API Configuration</h2>
                <div class="form-group">
                    <label for="apiUrl">Copernicus CDS API URL:</label>
                    <input type="text" id="apiUrl" value="https://cds.climate.copernicus.eu/api" 
                           placeholder="https://cds.climate.copernicus.eu/api">
                    <small>Base URL for the Climate Data Store API</small>
                </div>
            </section>

            <!-- API Keys Section -->
            <section class="config-section">
                <h2>ğŸ”‘ User API Keys</h2>
                <p class="section-description">Add API keys for users who will download data. You can add multiple users.</p>
                <div id="apiKeysContainer">
                    <!-- API keys will be added dynamically -->
                </div>
                <button type="button" class="btn-add" onclick="addApiKey()">
                    <span>+</span> Add User
                </button>
            </section>

            <!-- Variables Section -->
            <section class="config-section">
                <h2>ğŸŒ¡ï¸ Meteorological Hourly Variables</h2>
                <p class="section-description">Configure the variables to download with their specific parameters.</p>
                <div id="variablesContainer">
                    <!-- Variables will be added dynamically -->
                </div>
                <button type="button" class="btn-add" onclick="addVariable()">
                    <span>+</span> Add Variable
                </button>
            </section>

            <!-- Preview Section -->
            <section class="config-section preview-section">
                <h2>ğŸ‘ï¸ CONFIG.conf File Preview</h2>
                <button type="button" class="btn-preview" onclick="updatePreview()">
                    ğŸ”„ Update Preview
                </button>
                <pre id="configPreview" class="config-preview">Click "Update Preview" to see the file content...</pre>
            </section>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button type="button" class="btn-primary" onclick="generateConfig()">
                    ğŸ’¾ Download CONFIG.conf
                </button>
                <button type="button" class="btn-secondary" onclick="loadExistingConfig()">
                    ğŸ“‚ Load Existing Configuration
                </button>
                <button type="button" class="btn-secondary" onclick="resetForm()">
                    ğŸ”„ Reset Form
                </button>
            </div>
        </div>

        <footer>
            <p>Configuration Generator for Copernicus Climate Data Store API</p>
            <p class="footer-note">âš ï¸ Keep your API keys secure and do not share them publicly</p>
            <div class="footer-credits">
                <p>Developed by <a href="https://github.com/GheodeAI" target="_blank" rel="noopener noreferrer">GheodeAI</a></p>
                <p><a href="https://gheode.web.uah.es/" target="_blank" rel="noopener noreferrer">GHEODE Research Group - University of AlcalÃ¡</a></p>
            </div>
        </footer>
    </div>

    <!-- Hidden file input for loading config -->
    <input type="file" id="fileInput" accept=".conf" style="display: none;" onchange="handleFileUpload(event)">

    <!-- Map Selector Modal -->
    <div id="mapModal" class="map-modal" style="display: none;">
        <div class="map-modal-content">
            <div class="map-modal-header">
                <h3>ğŸ—ºï¸ Select Region on Map</h3>
                <button class="map-modal-close" onclick="closeMapSelector()">âœ•</button>
            </div>
            <div class="map-modal-body">
                <div class="map-mode-selector">
                    <button class="map-mode-btn active" id="rectangleMode" onclick="setMapMode('rectangle')">
                        ğŸ”² Rectangle
                    </button>
                    <button class="map-mode-btn" id="pointMode" onclick="setMapMode('point')">
                        ğŸ“ Point + Radius
                    </button>
                </div>
                <div class="map-instructions" id="rectangleInstructions">
                    <strong>ğŸ“Œ Rectangle Mode:</strong>
                    <ul style="margin: 10px 0 0 20px; padding: 0;">
                        <li><strong>Left-click and drag</strong> to draw a rectangle</li>
                        <li>Release the button to finish selection</li>
                        <li>Coordinates are automatically rounded to <strong>0.25Â°</strong></li>
                    </ul>
                </div>
                <div class="map-instructions" id="pointInstructions" style="display: none;">
                    <strong>ğŸ“Œ Point + Radius Mode:</strong>
                    <ul style="margin: 10px 0 0 20px; padding: 0;">
                        <li><strong>Click on a point</strong> on the map</li>
                        <li>Adjust the <strong>radius in degrees</strong> with the slider</li>
                        <li>A square region will be created around the point</li>
                    </ul>
                    <div style="margin-top: 10px; padding: 10px; background: white; border-radius: 4px;">
                        <label for="radiusSlider" style="font-weight: 600;">Radius (degrees): <span id="radiusValue">5.0</span>Â°</label>
                        <input type="range" id="radiusSlider" min="0.25" max="45" step="0.25" value="5" 
                               style="width: 100%; margin-top: 5px;"
                               oninput="updateRadius(this.value)">
                        <small style="color: #666;">Minimum: 0.25Â° â€¢ Maximum: 45Â° (approx. 5000 km)</small>
                    </div>
                </div>
                <div id="map" style="height: 500px; width: 100%;"></div>
            </div>
            <div class="map-modal-footer">
                <button class="btn-secondary" onclick="closeMapSelector()">Cancel</button>
                <button class="btn-primary" onclick="applyMapSelection()">Apply Selection</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="script.js"></script>
</body>
</html>
